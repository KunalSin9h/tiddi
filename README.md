<div align="center">

![My project-1](https://user-images.githubusercontent.com/82411321/212463201-06bf33cd-0665-42a5-8904-9a096dd10247.png)

```Ocaml
Tiddy is self hosted image server written in Go
```
</div>

## Demo
Go to https://tiddi.kunalsin9h.dev to see a demo of the project.

## Features (API)
- [x] Upload images
- [x] View images
- [x] Delete images
- [x] Update images
- [x] Get image details

## Setup Locally

### Prerequisites
- [Go](https://golang.org/dl/) (latest version recommended)
- [SQLite](https://www.sqlite.org/download.html) (latest version recommended)

### Steps
1. Clone the repo
```bash
git clone https://github.com/kunalsin9h/tiddi.git
```
2. Change the working directory
```bash
cd tiddi
```
3. Create a database folder in the root directory
```bash
mkdir database
```
4. Create a sqlite3 database file in the database folder
```bash
touch database/dev.db
```
5. Crete `images` table in the database file
```bash
sqlite3 database/dev.db
```
Execute the following SQL query in the sqlite3 shell
```sql
CREATE TABLE images (
    id varchar(7) primary key,
    title varchar(255),
    image blob not null
);
```
Exit the sqlite3 shell
```bash
.exit
```

6. Run the server
```bash
go run main.go
```
7. Open http://localhost:5656 in your browser

## Environment Variables
You can set the following environment variables to change the default settings of the server.

| Environment Variable | Default Value | Description |
| :------------------- | :------------ | :---------- |
| `PORT` | `5656` | Port on which the server will run |
| `DB` | `./database/dev.db` | Path to the database file |
| `HOST` | `localhost` | Host on which the server will run |

#### Example
```bash
export PORT=8080
export DB=./database/prod.db
export HOST=https://tiddi.kunalsin9h.dev

go run main.go
```

or alternative way is set the environment while running the server
```bash
PORT=8080 DB=./database/prod.db HOST=https://tiddi.kunalsin9h.dev go run main.go
```

> The `HOST` environment variable is used to generate the `unique image id` of the image, it is recommended to set it to the domain name of the server. `HOST` is also used in the sample frontend to fetch the image from the server.

## API Reference
### Sample Client
#### The Sample Frontend is available at `./src/frontend` directory, it is served by the server at `/` route.
```http
GET /
```

### Upload Image
```http
POST /upload-image/
```

| Parameter | Type     | Description                       |
| :-------- | :------- | :-------------------------------- |
| `image` | `[]byte` | **Required**. Image bytes to upload |
| `title` | `string` | **Optional**. Title of the image |

Response:
```json
{
  "url": "Unique URL of the image"
}
```


### View Image
```http
GET /{uiid}
```
> Image with `uiid` is served at this route

### Get Image Details
```http
GET /get-image/
```

| Parameter | Type     | Description                       |
| :-------- | :------- | :-------------------------------- |
| `uiid` | `string` | **Required**. UIID of the image |

Response:
```json
{
  "title": "Image Title",
  "image": "Base64 Encoded Image"
}
```

> UIID is the `unique image id` of the image, it is generated by the server and is returned when the image is uploaded.

### Delete Image
```http
DELETE /delete-image/
```

| Parameter | Type     | Description                       |
| :-------- | :------- | :-------------------------------- |
| `uiid` | `string` | **Required**. UIID of the image      |

### Update Image
```http
PUT /update-image/
```

| Parameter | Type     | Description                          |
| :-------- | :------- | :------------------------------------|
| `uiid`    | `string` | **Required**. UIID of the image      |
| `image`   | `[]byte` | **Optional**. Image bytes to upload  |
| `title`   | `string` | **Optional**. Title of the image     |

## Tech Stack

**Client:** HTML, CSS, JavaScript

**Server:** Go, SQLite

## Authors

- [@KunalSin9h](https://github.com/KunalSin9h)

## License

[MIT](https://choosealicense.com/licenses/mit/)

## Acknowledgements

 - [Mattn's SQLite3 driver for Go](https://github.com/mattn/go-sqlite3)
 - [matoous's go-nanoid](https://github.com/matoous/go-nanoid)

## Support

For support, email `kunal@kunalsin9h.dev`

## Feedback

If you have any feedback, please reach out to us at `kunal@kunalsin9h.dev`

## Contributing

Contributions are always welcome!

Enjoy! ðŸš€